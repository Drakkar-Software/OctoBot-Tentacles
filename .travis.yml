notifications:
  email: false
sudo: enabled
os: linux
language: python
cache: pip
python: 3.8-dev
env:
  global:
    - GH_REPO=Drakkar-Software/OctoBot-Tentacles
    - DEPLOY_BRANCH=master

install:
  - git clone https://github.com/Drakkar-Software/OctoBot.git && cd OctoBot
  - if [[ $TRAVIS_BRANCH == "dev" ]]; then git checkout dev; fi
  - python3 -m pip install -r requirements.txt -r dev_requirements.txt

matrix:
  include:
    - name: "Linux - Python 3 nightly"
      stage: test
      os: linux
      python: 3.8
      language: python
      script: echo "TODO"

    - name: "Linux - Tentacles - Deploy"
      stage: deploy
      os: linux
      install: skip
      script:
        - mkdir reference_tentacles
        - cp -r Backtesting Evaluator Interfaces Notifiers Services Services_feeds Trading reference_tentacles
        - zip -9 -q -r $TRAVIS_TAG.zip reference_tentacles
      deploy:
        - provider: script
          script: curl -v --user "$NEXUS_USERNAME:$NEXUS_PASSWORD" --upload-file ./$TRAVIS_TAG.zip  https://www.tentacles.octobot.online/repository/tentacles/releases/$TRAVIS_TAG.zip
          skip_cleanup: true
          cleanup: false
          on:
            repo: "$GH_REPO"
            tags: true
            condition: "$TRAVIS_OS_NAME = 'linux'"
